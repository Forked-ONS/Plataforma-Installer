FROM pmoneda/python:latest

WORKDIR /usr/src
RUN git clone -b feature/migracao-versao-nova https://github.com/ONSBR/Plataforma-ApiCore.git
RUN ls ./Plataforma-ApiCore
WORKDIR /usr/src/Plataforma-ApiCore/plataforma_apicore
RUN pwd

ENV PORT=9110
ENV POSTGRES_HOST postgres
ENV POSTGRES_USER postgres

RUN pip install -r requirements.txt
RUN pip install gunicorn

EXPOSE 9110
ENTRYPOINT python main.py && gunicorn -b 0.0.0.0:9110 api.server:app